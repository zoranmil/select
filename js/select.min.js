function Selects(t){this.defaultOptions={button:null,dropdown:null,search:null,option:null,issearch:!1,didoption:null,placeholder:"Select",searchplaceholder:"search",odabrano:"Selected",ajaxUrl:"",data:{q:"q"},ismultiselect:!1,find:null,onSelect:null},this.config=Object.assign({},this.defaultOptions,t||{}),this.config.option="string"==typeof this.config.option?document.querySelector(this.config.option):this.config.option,this.isDropdownOpen=!1,this.currentOptionIndex=0,this.lastTypedChar="",this.lastMatchingIndex=0,this.optionName="",this.options=null,this.didoption=null,this.ids=null,this.create()}Selects.prototype.create=function(){let t=this.config.option.options,e=this.config.option.getAttribute("name"),o=this.config.option.getAttribute("id"),n=this.config.option.getAttribute("style");if(null===o&&(o=e),null===n&&(n=""),this.ids=o,this.optionName=e,null!==this.config.option.getAttribute("multiple")&&(this.config.ismultiselect=!0),!this.config.ismultiselect)for(i=0;i<t.length;i++)null!==t[i].getAttribute("selected")&&(this.config.placeholder=t[i].textContent);let s=99999-document.querySelectorAll(".select-container").length,l='<button			role="combobox'+o+'"	value="';for(l+=this.config.placeholder+'"	aria-controls="listbox"	aria-haspopup="listbox"	tabindex="0" aria-expanded="false">',l+=this.config.placeholder+'</button>	<ul role="listbox'+o+'" >',this.config.issearch&&(l+='<li class="select-search-box"><input type="text" class="select-search select-search'+o+'" placeholder="'+this.config.searchplaceholder+'" title="'+this.config.searchplaceholder+'"> </li>'),i=0;i<t.length;i++)selected=!1,null!==t[i].getAttribute("selected")&&(selected=!0),this.config.ismultiselect?selected?l+='<li role="option'+o+'" class="active" data-value="'+t[i].value+'" aria-selected="true"><label><input type="checkbox" checked="checked" name="'+e+'[]" value="'+t[i].value+'" />'+t[i].textContent+"</label></li>":l+='<li role="option'+o+'" data-value="'+t[i].value+'" ><label><input type="checkbox" name="'+e+'[]" value="'+t[i].value+'" />'+t[i].textContent+"</label></li>":selected?l+='<li role="option'+o+'" class="active" data-value="'+t[i].value+'" aria-selected="true">'+t[i].textContent+"</li>":l+='<li role="option'+o+'" data-value="'+t[i].value+'" >'+t[i].textContent+"</li>";if(l+="</ul>",!this.config.ismultiselect){for(l+='<div class="select-hidden-accessible"><select id="'+o+'" name="'+e+'">',i=0;i<t.length;i++)selected="",null!==t[i].getAttribute("selected")&&(selected='selected="selected"'),l+='<option  value="'+t[i].value+'" '+selected+" >"+t[i].textContent+"</option>";l+=" </select></div>"}let c=document.createElement("div");if(c.classList.add("select-container"),c.innerHTML=l,n=n+"z-index:"+s+";",c.setAttribute("style",n),this.config.option.replaceWith(c),this.didoption=document.querySelector("#"+o),this.config.button=document.querySelector('[role="combobox'+o+'"]'),this.config.dropdown=document.querySelector('[role="listbox'+o+'"]'),this.options=document.querySelectorAll('[role="option'+o+'"]'),this.config.issearch&&(this.config.search=document.querySelector(".select-search"+o)),this.config.ismultiselect){let r=0,a=0;this.options.forEach(t=>{a++,null===t.firstElementChild.firstChild?!0==t.firstElementChild.checked&&r++:!0==t.firstElementChild.firstChild.checked&&r++}),r>0&&(this.config.button.innerHTML=this.config.odabrano+" "+r+"/"+a)}this.bindEvent()},Selects.prototype.Search=function(t){if(""==t){this.options.forEach(t=>{t.style.display="flex"});return}if("function"==typeof this.config.find){this.config.find(t,option,this);return}this.options.forEach(e=>{e.style.display=e.innerHTML.toLowerCase().indexOf(t.toLowerCase())>-1?"flex":"none"})},Selects.prototype.handleDocumentInteraction=function(t){let e=this.config.button.contains(t.target),o=this.config.dropdown.contains(t.target);(e||!o&&this.isDropdownOpen)&&this.toggleDropdown();let n=t.target.closest('[role="option'+this.ids+'"]');if(null!==n){if(this.config.ismultiselect){null===n.firstElementChild.firstChild?!0==n.firstElementChild.checked?(n.firstElementChild.setAttribute("checked","checked"),n.classList.add("active")):(n.firstElementChild.removeAttribute("checked"),n.classList.remove("active")):!0==n.firstElementChild.firstChild.checked?(n.firstElementChild.firstChild.setAttribute("checked","checked"),n.classList.add("active")):(n.firstElementChild.firstChild.removeAttribute("checked"),n.classList.remove("active"));let s=0,l=0;this.options.forEach(t=>{l++,null===t.firstElementChild.firstChild?!0==t.firstElementChild.checked&&s++:!0==t.firstElementChild.firstChild.checked&&s++}),this.config.button.innerHTML=this.config.odabrano+" "+s+"/"+l}else{if(null!=n)for(var c=0;c<this.didoption.length;c++)(option=this.didoption.options[c]).value==n.getAttribute("data-value")?option.setAttribute("selected","selected"):option.removeAttribute("selected");n&&this.selectOptionByElement(n)}}},Selects.prototype.selectOptionByElement=function(t){let e=t.textContent;"function"==typeof this.config.onSelect&&(element=t.getAttribute("data-value"),this.config.onSelect(element,this.options)),this.didoption.value=t.getAttribute("data-value"),this.config.button.textContent=e,this.options.forEach(t=>{t.classList.remove("active"),t.setAttribute("aria-selected","false")}),t.classList.add("active"),t.setAttribute("aria-selected","true"),this.toggleDropdown()},Selects.prototype.toggleDropdown=function(){this.config.dropdown.classList.toggle("active"),this.isDropdownOpen=!this.isDropdownOpen,this.config.button.setAttribute("aria-expanded",this.isDropdownOpen.toString()),this.isDropdownOpen?this.focusCurrentOption():(this.config.issearch&&(this.config.search.value=""),this.options.forEach(t=>{t.style.display="flex"}),this.config.button.focus())},Selects.prototype.ajax=function(t){let e=this,o={};Object.entries(this.config.data).forEach(e=>{let[n,s]=e;"q"==n?o[s]=t:o[n]=s}),e.opajax({url:e.config.ajaxUrl,type:"POST",data:o,dataType:"json",success:function(t){if(e.options.forEach(t=>{e.config.ismultiselect?!0!==t.firstElementChild.firstChild.checked&&t.remove():t.remove()}),!e.config.ismultiselect)for(;e.didoption.options.length>0;)e.didoption.remove(0);for(var o=0;o<t.length;o++)e.addelement(t[o].name,t[o].id)}})},Selects.prototype.opajax=function(t){t.type=(t.type||"GET").toUpperCase(),t.async=null==t.async||t.async,t.contentType=null==t.contentType||t.contentType,t.dataType=null!=t.dataType?t.dataType:"html";var e=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");if(e.onreadystatechange=function(){if(4==e.readyState){var o=e.status;o>=200&&o<300?"json"==t.dataType?t.success&&t.success(JSON.parse(e.responseText),e.responseXML):t.success&&t.success(e.responseText,e.responseXML):t.fail&&t.fail(o)}},t.contentType&&this.isJson(t.data)){var o=[];for(var n in t.data)o.push(encodeURIComponent(n)+"="+encodeURIComponent(t.data[n]));t.data=o.join("&")}"GET"==t.type?(e.open("GET",t.url+"?"+t.data,t.async),e.send(null)):"POST"==t.type&&(e.open("POST",t.url,t.async),t.contentType&&e.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),e.send(t.data))},Selects.prototype.isJson=function(t){if("string"==typeof t)return!1;try{JSON.parse(JSON.stringify(t))}catch(e){return!1}return!0},Selects.prototype.clear=function(){this.options.forEach(t=>{t.remove()}),this.config.dropdown=document.querySelector('[role="listbox'+this.ids+'"]'),this.options=document.querySelectorAll('[role="option'+this.ids+'"]')},Selects.prototype.addelement=function(t,e){if(this.config.ismultiselect)html='<li role="option'+this.ids+'" data-value="'+e+'" ><label><input type="checkbox" name="'+this.optionName+'[]" value="'+e+'" />'+t+"</label></li>",this.config.dropdown.innerHTML+=html;else{let o=document.createElement("li");o.textContent=t,o.setAttribute("role","option"),o.setAttribute("data-value",e),this.config.dropdown.appendChild(o)}if(this.config.dropdown=document.querySelector('[role="listbox'+this.ids+'"]'),this.options=document.querySelectorAll('[role="option'+this.ids+'"]'),!this.config.ismultiselect){let n=new Option(t,e);this.didoption.add(n)}},Selects.prototype.handleSearch=function(t){let e=t.target.value;if(""==this.config.ajaxUrl){if(""==e){this.options.forEach(t=>{t.style.display="flex"});return}this.Search(e);return}!(e.length<2)&&this.ajax(e)},Selects.prototype.bindEvent=function(){this.config.issearch&&this.config.search.addEventListener("keyup",this.handleSearch.bind(this)),document.addEventListener("click",this.handleDocumentInteraction.bind(this))},Selects.prototype.focusCurrentOption=function(){if("0"==this.currentOptionIndex)return;let t=this.options[this.currentOptionIndex];if(void 0===t){this.config.button.focus();return}void 0!==t.textContent&&(t.textContent,t.classList.add("current"),t.focus(),t.scrollIntoView({block:"nearest"}),this.options.forEach((e,o)=>{e!==t&&e.classList.remove("current")}))};(function ( $) { $.prototype.Selects = function (options) {this.each(function(){	defaultOptions ={option:this }; config  = Object.assign({},defaultOptions, options || {});	new Selects(config);});};})(JaJS);
